<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ÂÆåÊï¥ÂçäÈü≥ÈãºÁê¥ÈçµÁõ§</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f0f0;
    }
    .piano {
      position: relative;
      display: inline-block;
      margin-top: 40px;
    }
    .white-key, .black-key {
      display: inline-block;
      position: absolute;
      border: 1px solid #333;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      cursor: pointer;
      text-align: center;
      font-size: 12px;
    }
    .white-key {
      width: 40px;
      height: 180px;
      background: white;
      z-index: 1;
    }
    .black-key {
      width: 26px;
      height: 110px;
      background: black;
      color: white;
      z-index: 2;
    }
    .active {
      background: #88f !important;
    }
  </style>
</head>
<body>

<h1>üéπ ÈãºÁê¥ÈçµÁõ§ C4 ~ D5ÔºàÂê´ÂçäÈü≥Ôºâ</h1>
<p>ÊîØÊè¥ÊªëÈº†ËàáÈçµÁõ§Êìç‰Ωú</p>
<div class="piano" id="piano"></div>

<script>
const context = new (window.AudioContext || window.webkitAudioContext)();
const notes = {
  'z': { note: 'C4', freq: 261.63, pos: 0 },
  's': { note: 'C#4', freq: 277.18, pos: 30, black: true },
  'x': { note: 'D4', freq: 293.66, pos: 40 },
  'd': { note: 'D#4', freq: 311.13, pos: 70, black: true },
  'c': { note: 'E4', freq: 329.63, pos: 80 },
  'v': { note: 'F4', freq: 349.23, pos: 120 },
  'g': { note: 'F#4', freq: 369.99, pos: 150, black: true },
  'b': { note: 'G4', freq: 392.00, pos: 160 },
  'h': { note: 'G#4', freq: 415.30, pos: 190, black: true },
  'n': { note: 'A4', freq: 440.00, pos: 200 },
  'j': { note: 'A#4', freq: 466.16, pos: 230, black: true },
  'm': { note: 'B4', freq: 493.88, pos: 240 },
  'k': { note: 'C5', freq: 523.25, pos: 280 },
  'l': { note: 'D5', freq: 587.33, pos: 320 }
};

const oscillators = {};

const piano = document.getElementById('piano');

// Render keys
for (let key in notes) {
  const note = notes[key];
  const div = document.createElement('div');
  div.className = note.black ? 'black-key' : 'white-key';
  div.style.left = note.pos + 'px';
  div.dataset.key = key;
  div.title = `${note.note} (${key.toUpperCase()})`;
  div.innerHTML = note.black ? key.toUpperCase() : `<br>${key.toUpperCase()}`;
  div.addEventListener('mousedown', () => startNote(key));
  div.addEventListener('mouseup', () => stopNote(key));
  div.addEventListener('mouseleave', () => stopNote(key));
  piano.appendChild(div);
}

function startNote(key) {
  if (oscillators[key]) return;
  const data = notes[key];
  if (!data) return;

  const osc = context.createOscillator();
  const gain = context.createGain();
  osc.type = 'sine';
  osc.frequency.value = data.freq;
  gain.gain.setValueAtTime(0.2, context.currentTime);
  osc.connect(gain).connect(context.destination);
  osc.start();

  oscillators[key] = { osc, gain };

  document.querySelector(`[data-key="${key}"]`)?.classList.add('active');
}

function stopNote(key) {
  const obj = oscillators[key];
  if (!obj) return;

  obj.gain.gain.exponentialRampToValueAtTime(0.001, context.currentTime + 0.5);
  obj.osc.stop(context.currentTime + 0.5);
  delete oscillators[key];

  document.querySelector(`[data-key="${key}"]`)?.classList.remove('active');
}

document.addEventListener('keydown', e => {
  if (!e.repeat) startNote(e.key);
});
document.addEventListener('keyup', e => {
  stopNote(e.key);
});
</script>

</body>
</html>
